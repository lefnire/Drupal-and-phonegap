<!doctype html>

<html>
	<head>
	
	
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" />
		<title>Post to Drupal site starting kit</title>
		
		<script src="phonegap.js" type="text/javascript" charset="utf-8"></script>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
<script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
<script type="text/javascript" src="drupal.js"></script>
</head>
<body>
	<div data-role="page" id="navig" class="navig" data-theme="b">
	<div data-role="header" id="title_bar" data-theme="a"><h1>Post to Drupal site starting kit</h1></div>

	URL to services endpoint:<input type="text" id="endpoint" />
	Username:<input type="text" id="user" />
	Password:<input type="password" id="password" />
	<button id="login">Login</button>
	<button id="logout">Log out</button>
	<button id="postnode">Post node</button>
</div>


<script>
// Wait for PhoneGap to load
//
document.addEventListener("deviceready", onDeviceReady, false);

// PhoneGap is ready
//
function onDeviceReady() {
	LoadSettings();
}
$( document ).delegate("#navig", "pagecreate", function() {
	$('#login').click(function() {
		var data = {
			'pass': $('#password').val(),
			'user': $('#user').val(),
			'url': $('#endpoint').val()
		};
		drupalServicesLogin(data);
	});
	$('#logout').click(function() {
		url = $('#endpoint').val();
		drupalServicesLogout(url);
	});
	$('#postnode').click(function() {
		var date = new Date();
		var timestamp = Math.round(date.getTime() / 1000);
		var node_object = {
			"type": prompt("Enter content type"),
			"title": prompt("Enter node title"),
			"body": { "und": { 0 : { "value": prompt("Enter body text") } } },
			"created": timestamp, // Set key to 'created' for node.save. Use 'changed' for node.update 
			"status": 1 // Set to 1 for Published. O for unpublished.
		};
		url = $('#endpoint').val();
		drupalServicesPostNode(node_object, url, gotopage);
	});
	$('input').change(function() {
		localStorage.setItem("user", $('#user').val());
		localStorage.setItem("end", $('#endpoint').val());
		localStorage.setItem("pass", $('#password').val());
	});
});
function LoadSettings() {
	if (localStorage.getItem("user")) {
		$('#user').val(localStorage.getItem("user"));
	}
	if (localStorage.getItem("end")) {
		$('#endpoint').val(localStorage.getItem("end"));
	}
	if (localStorage.getItem("pass")) {
		$('#password').val(localStorage.getItem("pass"));
	}
}
function gotopage(data) {
	var a = confirm("Node posted sucessfully. Do you want to navigate to it?");
	
	if (a == true) {
	  url = prompt("Enter base path (no trailing slash)");
	  window.parent.location = url + '/node/' + data.nid;
	}
	else {
	  //
	}
}
</script> 
</body>
</html>